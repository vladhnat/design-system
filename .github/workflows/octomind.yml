name: Octomind E2E Tests

on:
  deployment_status:

jobs:
  octomind:
    if: github.event.deployment_status.state == 'success'
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: read
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      # Add any steps needed to deploy your application to a test environment
      # ...

      - name: Generate Octomind Tests
        uses: octomind-dev/octomind-action-batch-generation@main
        with:
          token: ${{ secrets.octomind_API_KEY }}
          testTargetId: 96ce3c22-add9-4b72-8b31-5d9d0a19c11c
          baseUrl: https://your-deployment-url.example.com
          # Optional parameters
          # entrypointUrlPath: /some/path
          # environmentId: your-environment-id
          # prerequisiteId: your-prerequisite-test-id
      - name: Show Batch Gen as PR comment
        uses: actions/github-script@v7
        env:
          BATCH_GEN_URL: ${{ steps.batch-gen.outputs.batchGenerationUrl }}
        with:
          github-token: ${{ github.token }}
          script: |
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.payload.pull_request.number,
              body: `# üêô Octomind Batch Generation\n\n[View your batch generation results](${process.env.BATCH_GEN_URL})`,
            });
